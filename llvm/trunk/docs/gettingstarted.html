<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Getting Started</title>
<link rel="stylesheet" type="text/css" href="style.css"/>
</head>
<body>

<h1>Getting started with avr-llvm</h1>
<p>
First steps with <a href="http://avr-llvm.sourceforge.net">avr-llvm</a>.
</p>

<h2><a name="compile">Building llvm with avr support</a></h2>

<p>Get the LLVM source:</p>
<pre>
$ svn co http://llvm.org/svn/llvm-project/llvm/trunk llvm
</pre>

<p>Get the avr-llvm source:</p>
<pre>
$ svn co https://avr-llvm.svn.sourceforge.net/svnroot/avr-llvm/llvm/trunk avr-llvm
</pre>

<p>Patch the LLVM source in order to support the avr target:</p>
<pre>
$ cd llvm
llvm$ patch -p0 &lt; ../avr-llvm/patches/configure.ac.diff 
llvm$ patch -p0 &lt; ../avr-llvm/patches/Tripple.diff 
llvm$ patch -p0 &lt; ../avr-llvm/patches/CMake/CMake.diff 
</pre>

<p>Replace autogenerated files:</p>
<pre>
$ cp ../avr-llvm/patches/configure ./
$ cp ../avr-llvm/patches/CMake/LLVMLibDeps.cmake cmake/modules/
<pre>

<p>Copy the AVR target implementation into the LLVM source tree:</p>  
<pre>
llvm$ cp -rf ../avr-llvm/AVR lib/Target/  
</pre>

<p>Configure and make LLVM:</p>
<pre>
$ cd ..
$ mkdir build
$ cd ../build

build$ ../llvm/configure --prefix=$HOME/usr/avr-llvm/ --disable-optimized --enable-targets=avr
build$ make
</pre>

<p>
If make was successful the avr target should be recognized by the llvm tools (e.g. 
<code>llc</code>);
</p>

<pre>
$ build/Debug/bin/llc --version

Low Level Virtual Machine (http://llvm.org/):
  llvm version 2.7svn
  DEBUG build with assertions.
  Built Dec  1 2009 (13:27:08).
  Host: i386-pc-linux-gnu
  Host CPU: yonah

  Registered Targets:
    avr - AVR [experimental]
</pre>

<h2>Using avr-llvm</h2>

<p>
<strong>Note:</strong> It is assumed that the llvm tools with avr support are in 
<code>build/Debug/bin</code>.
</p>

<p>Compile LLVM Bitcode to AVR asm:</p>
<pre>
$ build/Debug/bin/llc --march=avr avrtest.bc -o avrtest.s
</pre>

<p>
Transform LLVM Assembler (<code>.ll</code>) to LLVM bitcode 
(<code>.bc</code>). (This is not avr specific!):
</p>
<pre>
$ build/Debug/bin/llvm-as avrtest.ll -o avrtest.bc
</pre>

<p>
Transform LLVM bitcode <code>.bc</code>) to LLVM Assembler 
(<code>.ll</code>). (This is not avr specific!):
</p>
<pre>
$ build/Debug/bin/llvm-dis avrtest.bc -o avrtest.ll
</pre>

<p>Check supported CPUs and Features:</p>

<pre>
$ build/Debug/bin/llvm-as &lt; /dev/null | Debug/bin/llc -march=avr -mcpu=help
</pre>

<h2>Front-end for avr-llvm</h2>

<p>Not yet implemented!</p>

<hr/>

<address>
  <a href="http://validator.w3.org/check?uri=referer"><img
     src="http://www.w3.org/Icons/valid-xhtml10"
     alt="Valid XHTML 1.0 Strict" height="31" width="88" /></a>
<a href="http://avr-llvm.sourceforge.net">avr-llvm</a>
</address>

</body>
</html>
